{% block extra_head %}
  <style>
      .scrollable {
          height: calc(100vh - 110px);
          overflow-y: scroll;
      }

      .order-header-date {
          font-size: 14px;
      }

      .order-table-names {
          background-color: lightgray;
      }

      .order-table-total {
          background-color: lightgray;
      }

      .order-table-heading tr th {
          white-space: nowrap;
          text-overflow: clip;
          padding: 1px;
      }

      .order-table {
          font-size: 12px;
      }

      .order-table-cell-overflow {
          font-weight: bold;
          color: red;
      }
  </style>
{% endblock %}

<div class="scrollable" id="orders-list">
  {% for order in orders %}
    <div class="card mb-1" id="order-card">
      <div class="card-header p-2" {% if order.in_progress %} style="background-color: lightblue" {% endif %}>
        <div class="row">
          <div class="col-auto ms-0 align-self-center">
            {{ order.name }} <b>№ {{ order.number }}</b>
          </div>
          <div class="col-auto me-auto align-self-center order-header-date">
            {{ order.date|date:'d.m.y H:i' }}
          </div>
          <div class="col-auto ms-auto">
            <div class="btn-group btn-group-sm">
              <a class="btn btn-secondary" type="button" href="{% url 'orders_edit' order.pk %}">
                <i class="bi bi-pencil-fill"></i>
              </a>
              <button class="btn btn-danger"
                      type="button"
                      hx-post="{% url 'orders_delete' order.pk %}"
                      hx-target="closest #order-card"
                      hx-swap="outerHTML"
                      hx-trigger="click"
                      hx-confirm="Вы уверены что вы хотите удалить {{ order.name }} #{{ order.number }}">
                <i class="bi bi-trash-fill"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="card-body" style="padding: 0">
        <div id="order-entries-list-{{ order.pk }}">
          <div class="table-responsive">
            <table class="table table-bordered bg-white mb-0 order-table">
              <colgroup>
                <col class="order-table-names"/>
                <col class="order-table-total"/>
                <col/>
              </colgroup>
              <thead class="order-table-heading">
              <tr>
                <th class="text-center" scope="col" style="width: 35%">Деталь</th>
                <th class="text-center" scope="col" style="width: 13%">Всего</th>
                {% for step in steps %}
                  <th class="text-center" scope="col" style="width: 13%"> {{ step.name }} </th>
                {% endfor %}
              </tr>
              </thead>
              <tbody>
              {% for order_entry in order.orderentry_set.all %}
                <tr class={{ order_entry.detail|get_detail_class }}>
                  <td class="text-center">
                    {{ order_entry.detail }}
                  </td>
                  <td class="text-center">
                    {{ order_entry.quantity }}
                  </td>
                  {% for step in steps %}
                    <td class="text-center {% if leftovers|lookup:step.pk|lookup:order_entry.pk >= 0 %} order-table-cell-overflow {% endif %}">
                      {% if leftovers|lookup:step.pk|lookup:order_entry.pk >= 0 %}
                        +{% endif %}{{ leftovers|lookup:step.pk|lookup:order_entry.pk }}
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
</div>